<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JaeWonFlight</title>
  <link rel="stylesheet" href="CSS/main.css">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>
  <header class="main-header">
    <div class="logo" id="logoLink">ğŸŒJaeWonFlight</div>
    <nav class="main-nav">
      <ul id="authLinks">
        <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ì—¬ê¸°ì— ë²„íŠ¼ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </ul>
    </nav>
  </header>

<div class="content-container">
  <!-- Image container -->
  <div class="image-container">
    <!-- Image will be placed here via CSS -->
  </div>

  <!-- Search panel container -->
  <div class="search-panel-container">
    <!-- Existing search panel HTML here -->
    <div class="search-panel">
      <div class="tab-group">
        <button class="tab" id="flightsTab">í•­ê³µí¸</button>
      </div>
    
      <div class="search-fields">
        <div class="field-group">
          <label for="departure">ì¶œë°œì§€</label>
          <button class="dropdown-toggle" id="departureToggle">ì„œìš¸ (ëª¨ë‘)</button>
          <div id="departureDropdown" class="dropdown-content">
            <ul>
              <li><a href="javascript:void(0);" data-value="í•œêµ­ ì¸ì²œêµ­ì œê³µí•­ (ICN)">í•œêµ­ ì¸ì²œêµ­ì œê³µí•­ (ICN)</a></li>
              <li><a href="javascript:void(0);" data-value="í•œêµ­ ê¹€í¬ (GMP)">í•œêµ­ ê¹€í¬ (GMP)</a></li>
            </ul>
          </div>
        </div>
      </div>
        
      <div class="search-fields">
        <div class="field-group">
          <label for="destination">ë„ì°©ì§€</label>
          <button class="dropdown-toggle" id="destinationToggle">êµ­ê°€, ë„ì‹œ ë˜ëŠ” ê³µí•­</button>
          <div id="destinationDropdown" class="dropdown-content">
            <ul>
              <li><a href="javascript:void(0);" data-value="ì¼ë³¸ ë„ì¿„ (NRT)">ì¼ë³¸ ë„ì¿„ (NRT)</a></li>
              <li><a href="javascript:void(0);" data-value="ì¼ë³¸ í•˜ë„¤ë‹¤ (HND)">ì¼ë³¸ ë„ì¿„ (HND)</a></li>
              <li><a href="javascript:void(0);" data-value="ì¼ë³¸ ì˜¤ì‚¬ì¹´">ì¼ë³¸ ì˜¤ì‚¬ì¹´</a></li>
            </ul>
          </div>
        </div>
      </div>
    
    
        <div class="field-group">
          <label for="departureDate">ê°€ëŠ” ë‚ </label>
          <input type="date" id="departureDate" placeholder="ë‚ ì§œ ì…ë ¥">
        </div>
    
        <div class="field-group">
          <label for="returnDate">ì˜¤ëŠ” ë‚ </label>
          <input type="date" id="returnDate" placeholder="ë‚ ì§œ ì…ë ¥">
        </div>
    
        <div class="field-group">
          <label for="passengers">ì—¬í–‰ì ë° ì¢Œì„</label>
          <button id="passengers-button" class="dropdown-button">1 ì„±ì¸, ì¼ë°˜ì„</button>
          <div id="passenger-selector" class="passenger-dropdown">
            <div class="passenger-count">
              <span>ì„±ì¸</span>
              <div class="counter-container">
                <button class="passenger-minus" data-type="adults">-</button>
                <span id="adult-count">1</span>
                <button class="passenger-plus" data-type="adults">+</button>
              </div>
            </div>
            
            <button id="apply-passengers" class="apply-button">ì ìš©</button>
          </div>
        </div>
    
      <button class="search-button" id="searchFlights">ê²€ìƒ‰í•˜ê¸°</button>
    </div>
  </div>

</div>

<script>
// ë¡œê³  í´ë¦­ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
document.getElementById('logoLink').addEventListener('click', function() {
  window.location.href = "main.html";
});

// ë©”ë‰´ ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
//document.getElementById('menuButton').onclick = function() {
//  document.getElementById('mainNavigation').classList.toggle('show');
//};

// ë¡œê·¸ì¸ ë²„íŠ¼
document.addEventListener('DOMContentLoaded', function() {
  checkLoginStatus();
});

function checkLoginStatus() {
  const authLinks = document.getElementById('authLinks');
  if (localStorage.getItem('authToken')) {
    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ì•ˆì „í•˜ê²Œ ë™ì ìœ¼ë¡œ ì¶”ê°€í•˜ê¸° ìœ„í•´, 
    // createElementì™€ appendChildë¥¼ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
    var logoutLi = document.createElement('li');
    var logoutLink = document.createElement('a');
    logoutLink.href = "#";
    logoutLink.id = "logoutButton";
    logoutLink.textContent = "ë¡œê·¸ì•„ì›ƒ";
    logoutLink.addEventListener('click', function() {
      localStorage.removeItem('authToken');
      window.location.reload();
    });
    logoutLi.appendChild(logoutLink);
    authLinks.appendChild(logoutLi);

 // ë‚˜ì˜ ì˜ˆì•½ ì •ë³´ ë²„íŠ¼ ì¶”ê°€
    var reservationLi = document.createElement('li');
    var reservationLink = document.createElement('a');
    reservationLink.href = "reservation_info.html"; // ì˜ˆì•½ ì •ë³´ í˜ì´ì§€ë¡œ ê°€ëŠ” ê²½ë¡œ ì„¤ì •
    reservationLink.id = "reservationInfo";
    reservationLink.textContent = "ë‚˜ì˜ ì˜ˆì•½ ì •ë³´";
    reservationLi.appendChild(reservationLink);
    authLinks.appendChild(reservationLi);

  } else {
    authLinks.innerHTML = '<li><a id="loginButton" href="#">ë¡œê·¸ì¸</a></li><li><a href="signup.html">íšŒì›ê°€ì…</a></li>';

        // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
document.getElementById('loginButton').addEventListener('click', function() {
  // í˜„ì¬ í˜ì´ì§€ì˜ URLì„ sessionStorageì— 'returnUrl'ì´ë¼ëŠ” í‚¤ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
  sessionStorage.setItem('returnUrl', window.location.href);
  window.location.href = 'login.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
});
  }
}

// ë“œë¡­ë‹¤ìš´ í† ê¸€ í•¨ìˆ˜
function toggleDropdown(dropdownId) {
  var dropdown = document.getElementById(dropdownId);
  // ë‹¤ë¥¸ ëª¨ë“  ë“œë¡­ë‹¤ìš´ì„ ë‹«ê³  í˜„ì¬ ë“œë¡­ë‹¤ìš´ì˜ ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
  document.querySelectorAll('.dropdown-content').forEach(function(otherDropdown) {
    if (otherDropdown.id !== dropdownId) {
      otherDropdown.classList.remove('show');
    }
  });
  dropdown.classList.toggle('show');
}

// ë“œë¡­ë‹¤ìš´ì—ì„œ í•­ëª© ì„ íƒ ì‹œ ì²˜ë¦¬ í•¨ìˆ˜
function handleDropdownSelection(dropdownToggleId, dropdownId, value) {
  document.getElementById(dropdownToggleId).textContent = value;
  toggleDropdown(dropdownId); // ë“œë¡­ë‹¤ìš´ IDë¥¼ ë°”ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
}

// ì¶œë°œì§€ì™€ ë„ì°©ì§€ ë“œë¡­ë‹¤ìš´ í† ê¸€ ì´ë²¤íŠ¸
document.getElementById('departureToggle').addEventListener('click', function() {
  toggleDropdown('departureDropdown');
});
document.getElementById('destinationToggle').addEventListener('click', function() {
  toggleDropdown('destinationDropdown');
});

// ì¶œë°œì§€ì™€ ë„ì°©ì§€ ë“œë¡­ë‹¤ìš´ì—ì„œ í•­ëª© ì„ íƒ ì‹œ ì²˜ë¦¬ ì´ë²¤íŠ¸
document.querySelectorAll('.dropdown-content a').forEach(function(link) {
  link.addEventListener('click', function() {
    const dropdownContent = this.closest('.dropdown-content');
    const dropdownId = dropdownContent.id;
    const dropdownToggleId = dropdownId.replace('Dropdown', 'Toggle');
    handleDropdownSelection(dropdownToggleId, dropdownId, this.getAttribute('data-value'));
    dropdownContent.classList.remove('show'); // ë“œë¡­ë‹¤ìš´ì„ ë‹«ìŠµë‹ˆë‹¤.
  });
});

  // ìŠ¹ê° ìˆ˜ ì„ íƒ
  document.getElementById('passengers-button').addEventListener('click', function() {
    document.getElementById('passenger-selector').style.display = 'block';
  });

  // ìŠ¹ê° ìˆ˜ ì¡°ì ˆ ë¡œì§
  let adultCount = 1;
  let childrenCount = 0;

  function updatePassengerCount() {
    document.getElementById('adult-count').textContent = adultCount;
    document.getElementById('children-count').textContent = childrenCount;
  }

  document.querySelectorAll('.passenger-plus').forEach(function(button) {
    button.addEventListener('click', function() {
      if (this.getAttribute('data-type') === 'adults') {
        adultCount++;
      } else {
        childrenCount++;
      }
      updatePassengerCount();
    });
  });

  document.querySelectorAll('.passenger-minus').forEach(function(button) {
    button.addEventListener('click', function() {
      if (this.getAttribute('data-type') === 'adults' && adultCount > 1) {
        adultCount--;
      } 
      updatePassengerCount();
    });
  });

  document.getElementById('apply-passengers').addEventListener('click', function() {
    document.getElementById('passengers-button').textContent = adultCount + ' ì„±ì¸' ;
    document.getElementById('passenger-selector').style.display = 'none';
  });

  // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  document.getElementById('searchFlights').addEventListener('click', function() {
    searchFlights();
  });

  // ê²€ìƒ‰ ë°ì´í„°ë¥¼ Lambda í•¨ìˆ˜ë¡œ ë³´ë‚´ê³  ê²°ê³¼ ì²˜ë¦¬
  function searchFlights() {
    const departure = document.getElementById('departureToggle').textContent;
    const destination = document.getElementById('destinationToggle').textContent;
    const departureDate = document.getElementById('departureDate').value;
    const returnDate = document.getElementById('returnDate').value;
    const adults = parseInt(document.getElementById('adult-count').textContent, 10); // ì¸ì› ìˆ˜ë¥¼ ìˆ«ìë¡œ ë³€í™˜

    // API Gateway ì—”ë“œí¬ì¸íŠ¸ URL ìƒì„±
    const apiEndpoint = 'https://iyy1tuzep4.execute-api.ap-northeast-2.amazonaws.com/project-api-gateway-1/flightlist';
    const queryString = `?departure=${encodeURIComponent(departure)}&destination=${encodeURIComponent(destination)}&departureDate=${departureDate}&returnDate=${returnDate}&adults=${adults}`;
    // API Gatewayì— GET ìš”ì²­ ì „ì†¡
    fetch(apiEndpoint + queryString)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      sessionStorage.setItem('searchResults', JSON.stringify(data));
      window.location.href = 'flight_list.html'; // í˜ì´ì§€ ë¦¬ë””ë ‰ì…˜
    })
    .catch(error => {
      console.error('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    });
  }
</script>

</body>
</html>
